<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Duly Noted</title>
  <link rel="stylesheet" href="sidepanel.css">
</head>
<body>
  <!-- Main Container -->
  <div id="app" class="app">

    <!-- Header -->
    <header class="header">
      <h1 class="header-title">ğŸ¤ Duly Noted</h1>
      <button id="settingsBtn" class="icon-btn" title="Settings" aria-label="Open settings">
        <span>âš™ï¸</span>
      </button>
    </header>

    <!-- Main Content Area (screens will be toggled) -->
    <main class="main" id="mainContent">

      <!-- Screen: Recording Interface -->
      <div id="recordingScreen" class="screen active">
        <div class="recording-container">

          <!-- Recording Status -->
          <div id="recordingStatus" class="status-idle">
            <div class="status-icon">ğŸ¤</div>
            <div class="status-text">Ready to Record</div>
          </div>

          <!-- Recording Controls -->
          <div class="controls">
            <button id="recordBtn" class="btn btn-primary btn-large">
              <span id="recordBtnText">Start Recording</span>
            </button>
            <div id="recordingTimer" class="timer" style="display: none;">00:00</div>
          </div>

          <!-- Transcription Display -->
          <div id="transcriptionContainer" class="transcription-container" style="display: none;">
            <div class="section-header">
              <h2>Transcription</h2>
              <button id="editTranscriptionBtn" class="btn btn-small">Edit</button>
            </div>
            <div id="transcriptionText" class="transcription-text" contenteditable="false"></div>
          </div>

        </div>

        <!-- Recent Notes Preview -->
        <div class="recent-notes">
          <h3>Recent Notes</h3>
          <div id="recentNotesList" class="notes-list">
            <p class="empty-state">No notes yet. Start recording to create your first note!</p>
          </div>
          <button id="viewAllHistoryBtn" class="btn btn-secondary btn-full">View All History</button>
        </div>
      </div>

      <!-- Screen: Destination Chooser -->
      <div id="destinationScreen" class="screen">
        <div class="destination-container">

          <!-- Back Button -->
          <button id="backToRecordingBtn" class="btn btn-text">
            <span>â† Back</span>
          </button>

          <h2>Where should this go?</h2>

          <!-- Transcription Preview -->
          <div class="transcription-preview">
            <div id="destinationTranscriptionPreview" class="transcription-text-preview"></div>
          </div>

          <!-- Destination Options -->
          <div class="destination-options">

            <button class="destination-option" data-destination="draft">
              <div class="destination-icon">ğŸ’¾</div>
              <div class="destination-info">
                <div class="destination-name">Save as Draft</div>
                <div class="destination-desc">Decide later</div>
              </div>
            </button>

            <button class="destination-option" data-destination="github-issue" disabled>
              <div class="destination-icon">ğŸ™</div>
              <div class="destination-info">
                <div class="destination-name">Create GitHub Issue</div>
                <div class="destination-desc">Track as actionable task</div>
              </div>
              <div class="destination-badge">Not configured</div>
            </button>

            <button class="destination-option" data-destination="github-project" disabled>
              <div class="destination-icon">ğŸ“‹</div>
              <div class="destination-info">
                <div class="destination-name">Add to GitHub Project</div>
                <div class="destination-desc">Add to project board</div>
              </div>
              <div class="destination-badge">Not configured</div>
            </button>

            <button class="destination-option" data-destination="onenote" disabled>
              <div class="destination-icon">ğŸ“˜</div>
              <div class="destination-info">
                <div class="destination-name">OneNote</div>
                <div class="destination-desc">Quick notes</div>
              </div>
              <div class="destination-badge">Not configured</div>
            </button>

            <button class="destination-option" data-destination="notion" disabled>
              <div class="destination-icon">ğŸ““</div>
              <div class="destination-info">
                <div class="destination-name">Notion</div>
                <div class="destination-desc">Knowledge base</div>
              </div>
              <div class="destination-badge">Coming soon</div>
            </button>

          </div>

        </div>
      </div>

      <!-- Screen: GitHub Issue Creation -->
      <div id="githubIssueScreen" class="screen">
        <div class="form-container">

          <!-- Back Button -->
          <button id="backFromGitHubIssueBtn" class="btn btn-text">
            <span>â† Back</span>
          </button>

          <h2>Create GitHub Issue</h2>

          <!-- Repository Picker -->
          <div class="form-group">
            <label for="githubRepoSearch">Repository</label>
            <div class="repo-picker">
              <input
                type="text"
                id="githubRepoSearch"
                class="input"
                placeholder="Search repositories..."
                autocomplete="off">
              <div id="repoList" class="dropdown-list" style="display: none;">
                <div class="dropdown-section">
                  <div class="dropdown-section-title">Recently Used</div>
                  <div id="recentReposList"></div>
                </div>
                <div class="dropdown-section">
                  <div class="dropdown-section-title">All Repositories</div>
                  <div id="allReposList"></div>
                </div>
              </div>
            </div>
            <input type="hidden" id="selectedRepoId" value="">
          </div>

          <!-- Issue Title -->
          <div class="form-group">
            <label for="issueTitle">Title</label>
            <input
              type="text"
              id="issueTitle"
              class="input"
              placeholder="Brief description of the issue"
              required>
          </div>

          <!-- Issue Body -->
          <div class="form-group">
            <label for="issueBody">Description</label>
            <textarea
              id="issueBody"
              class="textarea"
              rows="6"
              placeholder="Detailed description (supports Markdown)"></textarea>
          </div>

          <!-- Labels (Optional) -->
          <div class="form-group">
            <label for="issueLabels">Labels (optional)</label>
            <input
              type="text"
              id="issueLabels"
              class="input"
              placeholder="bug, enhancement, etc. (comma-separated)">
          </div>

          <!-- Actions -->
          <div class="form-actions">
            <button id="createIssueBtn" class="btn btn-primary">Create Issue</button>
            <button id="cancelIssueBtn" class="btn btn-secondary">Cancel</button>
          </div>

        </div>
      </div>

      <!-- Screen: History -->
      <div id="historyScreen" class="screen">
        <div class="history-container">

          <!-- Back Button -->
          <button id="backFromHistoryBtn" class="btn btn-text">
            <span>â† Back</span>
          </button>

          <h2>History</h2>

          <!-- Filter Controls -->
          <div class="filter-controls">
            <select id="historyFilter" class="filter-select">
              <option value="all">All</option>
              <option value="draft">ğŸ’¾ Drafts only</option>
              <option value="github-issue">ğŸ™ GitHub Issues</option>
              <option value="github-project">ğŸ“‹ GitHub Projects</option>
              <option value="onenote">ğŸ“˜ OneNote</option>
            </select>
            <input type="search" id="historySearch" class="search-input" placeholder="Search...">
          </div>

          <!-- History List -->
          <div id="historyList" class="history-list">
            <p class="empty-state">No history yet.</p>
          </div>

        </div>
      </div>

      <!-- Screen: Settings -->
      <div id="settingsScreen" class="screen">
        <div class="settings-container">

          <!-- Back Button -->
          <button id="backFromSettingsBtn" class="btn btn-text">
            <span>â† Back</span>
          </button>

          <h2>Settings</h2>

          <!-- Settings Sections -->
          <div class="settings-section">
            <h3>ğŸ™ GitHub Integration</h3>

            <!-- OAuth Section (Default) -->
            <div id="githubOAuthSection">
              <div id="githubNotConnected" class="oauth-status">
                <p class="help-text">Connect your GitHub account to create issues and manage projects</p>
                <button id="githubSignInBtn" class="btn btn-primary btn-oauth">
                  <svg class="oauth-icon" viewBox="0 0 16 16" width="20" height="20" fill="currentColor">
                    <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path>
                  </svg>
                  Sign in with GitHub
                </button>
              </div>

              <div id="githubConnected" class="oauth-status" style="display: none;">
                <div class="connected-info">
                  <div class="connected-avatar">
                    <img id="githubAvatar" src="" alt="GitHub avatar" class="avatar-img">
                  </div>
                  <div class="connected-details">
                    <div class="connected-name" id="githubUsername">Loading...</div>
                    <div class="connected-email">Connected via OAuth</div>
                  </div>
                </div>
                <button id="githubSignOutBtn" class="btn btn-secondary btn-small">Sign Out</button>
              </div>

              <div class="developer-mode-toggle">
                <label class="toggle-label">
                  <input type="checkbox" id="developerModeToggle">
                  <span>Developer Mode (use token instead)</span>
                </label>
              </div>
            </div>

            <!-- Developer Mode Section (Hidden by default) -->
            <div id="githubDeveloperSection" style="display: none;">
              <div class="form-group">
                <label for="githubToken">Personal Access Token</label>
                <input type="password" id="githubToken" placeholder="ghp_..." class="input">
                <button id="testGitHubBtn" class="btn btn-small">Test Connection</button>
              </div>
              <p class="help-text">
                <a href="https://github.com/settings/tokens/new?scopes=repo,project,read:user" target="_blank">Generate a token</a> with repo, project, and read:user scopes
              </p>
            </div>
          </div>

          <div class="settings-section">
            <h3>ğŸ“ Notion Integration</h3>

            <!-- Notion OAuth Section -->
            <div id="notionOAuthSection">
              <div id="notionNotConnected" class="oauth-status">
                <p class="help-text">Connect your Notion workspace to save notes directly to pages</p>
                <button id="notionSignInBtn" class="btn btn-primary btn-oauth">
                  <svg class="oauth-icon" viewBox="0 0 100 100" width="20" height="20" fill="currentColor">
                    <path d="M6.017 4.313l55.333 -4.087c6.797 -0.583 8.543 -0.19 12.817 2.917l17.663 12.443c2.913 2.14 3.883 2.723 3.883 5.053v68.243c0 4.277 -1.553 6.807 -6.99 7.193L24.467 99.967c-4.08 0.193 -6.023 -0.39 -8.16 -3.113L3.3 79.94c-2.333 -3.113 -3.3 -5.443 -3.3 -8.167V11.113c0 -3.497 1.553 -6.413 6.017 -6.8z"/>
                  </svg>
                  Sign in with Notion
                </button>
              </div>

              <div id="notionConnected" class="oauth-status" style="display: none;">
                <div class="connected-info">
                  <div class="connected-avatar-container">
                    <div class="connected-icon" id="notionWorkspaceIcon">ğŸ“</div>
                  </div>
                  <div class="connected-details">
                    <div class="connected-name" id="notionWorkspaceName">Loading...</div>
                    <div class="connected-email">Connected via OAuth</div>
                  </div>
                </div>
                <button id="notionSignOutBtn" class="btn btn-secondary btn-small">Sign Out</button>
              </div>
            </div>
          </div>

          <div class="settings-section">
            <h3>ğŸ“˜ OneNote Integration</h3>
            <p class="help-text">OneNote integration coming in Phase 6</p>
          </div>

          <div class="settings-section">
            <h3>ğŸ¤ Recording</h3>
            <div class="form-group">
              <label for="maxDuration">Max Recording Duration (seconds)</label>
              <input type="number" id="maxDuration" value="300" min="60" max="600" class="input">
            </div>
          </div>

          <div class="settings-actions">
            <button id="saveSettingsBtn" class="btn btn-primary">Save Settings</button>
            <button id="resetSettingsBtn" class="btn btn-secondary">Reset to Defaults</button>
          </div>

        </div>
      </div>

    </main>

    <!-- Toast Notifications -->
    <div id="toastContainer" class="toast-container"></div>

  </div>

  <script src="sidepanel.js" type="module"></script>
</body>
</html>
